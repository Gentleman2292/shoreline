package com.momentum.impl.modules.exploit.pingspoof;

import com.momentum.api.event.FeatureListener;
import com.momentum.impl.events.vanilla.network.OutboundPacketEvent;
import net.minecraft.network.play.client.CPacketConfirmTransaction;
import net.minecraft.network.play.client.CPacketKeepAlive;

/**
 * @author linus
 * @since 02/26/2023
 */
public class OutboundPacketListener extends FeatureListener<PingSpoofModule, OutboundPacketEvent> {

    /**
     * Default constructor
     *
     * @param feature The associated feature
     */
    protected OutboundPacketListener(PingSpoofModule feature) {
        super(feature);
    }

    @Override
    public void invoke(OutboundPacketEvent event) {

        // packet that tells the server to keep the connection alive
        // we can also cancel CPacketConfirmTransaction packets
        if (event.getPacket() instanceof CPacketKeepAlive || event.getPacket() instanceof CPacketConfirmTransaction) {

            // cancel packet here, we will resend later
            feature.packets.offer(event.getPacket());
            event.setCanceled(true);
        }
    }
}
